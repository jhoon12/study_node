#  06. express 웹 서버 만들기



```javascript
const express = require('express');
//express 모듈 끌어오기
const app = express();
app.set('port', process.env.PORT|| 3000);
//process.env 객체에 port속성이 있다면 그 값을 사용, 없다면 3000번 포트를 사용한다
app.get('/', (req, res)=>{
    res.send('Hello, Express');
})
//주소에 대한 get요청에 대한 부분
//현재 응답으로 'Hello Express' 전달 중
app.listen(app.get('port'), () => {
    console.log(app.get('port'), '번 포트에서 대기 중');
})
//웹 서버 구동
```

## 문자열 대신 html로 응답하기

```javascript
const express = require("express");
const path = require("path");

const app = express();
app.set("port", process.env.PORT || 3000);
app.get("/", (req, res) => {
  res.sendFile(path.join(__dirname, "/index.html"));
});

app.listen(app.get("port"), () => {
  console.log(app.get("port"), "번 포트에서 대기 중");
});

```

path모듈과 res.sendFile메서드 이용

## 자주 사용되는 미들웨어

```javascript
const express = require("express");
const path = require("path");

const app = express();
app.set("port", process.env.PORT || 3000);
app.use("/", (req, res, next) => {
  console.log("모든 요청에 다 실행됩니다");
  next();
});
app.get(
  "/",
  (req, res, next) => {
    console.log("GET / 요청에서만 실행됩니다.");
    next();
  },
  (req, res) => {
    throw new Error("에러는 에러 처리 미들웨어로 갑니다");
  }
);

app.use((err, req, res, next) => {
  console.log(err);
  res.status(500).send(err.message);
});
app.listen(app.get("port"), () => {
  console.log(app.get("port"), "번 포트에서 대기 중");
});
```

미들웨어 형식

app.use(미들웨어)

next는 다음 미들웨어로 넘어가는 함수이다. next를 실행하지 않으면 다음 미들웨어가 실행되지 않는다.
주소를 첫 번째 인수로 안넣어주면 미들웨어는 모든 요청에서 실행되고, 주소를 넣는다면 해당하는 요청에서만 실행된다.

ex) 1. app.use(미들웨어) = 모든 요청에서 미들웨어 실행

   	  2. app.use('/abc', 미들웨어) = abc로 ㅅ작하는 요청에서 미들웨어 실행
         3. app.post('/abc', 미들웨어) = abc로 시작하는 post 요청에서 미들웨어 실행

순서도를 생각해 본다면

app.listen을 통해 3000번 포트에 서버가 켜진다 -> app.use(서버가 켜지느 것 또한 요청이기에)미들웨어 실행 ->

next()를 통해 app.get 실행 -> next를 통해 다음 미들웨어인 콜백을 실행 -> 콜백에서 에러 발생 -> 에러를 마지막 미들웨어인 app.use에 보내줌 -> app.use에서는 이 에러를 send를 통해 클라이언트에 보낸다.

